<!DOCTYPE html>
<html>
	<head>
		<title>TITLE</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<style type="text/css">
			html, body {
				padding: 0px;
				margin: 0px;
				width: 100%;
				height: 100%;
			}
			body {
				box-sizing: border-box;
				padding: 20px;
				display: flex;
				font-size: 120%;
				flex-direction: column;
			}
			.button {
				background-color: #219BE5; border-radius: 6px; padding: 14px; text-align: center; color: white;
				margin-top: 20px;
			}

			.button.disabled {
				pointer-events: none;
				background-color: #CDCDCD;
			}
		</style>
		<script src="script/jQuery.js"></script>
        <script src="script/Histone.js"></script>
	</head>
	<body>



		<script type="text/javascript">

			var template = `

				<div style="flex: 1;">
					<div style="margin-bottom: 20px;">
						{{if !this.permissions}}
							Разрешите сервису отсылать SMS, для этого нажмите кнопку "Установить разрешения для SMS"
							которая находится внизу экрана, затем кликните "Разрешить" в появившемся диалоговом окне.
						{{else}}
							Используйте следующий код для подключения к прокси и отсылки сообщений: {{this.phoneToken}}
						{{/if}}
					</div>
				</div>

				<div>
					{{if !this.permissions}}
						<div class="button requestPermissions">
							Установить разрешения для SMS
						</div>
					{{elseif this.isSubscribed}}
						<div class="button doUnsubscribe">
							Выключить прокси сервер
						</div>
					{{else}}
						<div class="button doSubscribe">
							Включить прокси сервер
						</div>
					{{/if}}
				</div>
		`;

			function updateUI() {
				Histone(template).render(function(result) {
					document.body.innerHTML = result;
				}, {
					permissions: android.checkPermissions(),
					phoneToken: android.getPhoneToken(),
					isSubscribed: android.getIsSubscribed()
				});
			}

			$(document).on('onSubscriptionChange onPermissionChange', updateUI);

			$(document).on('click', '.doSubscribe', function() {
				$(this).addClass('disabled');
				android.doSubscribe();
			});

			$(document).on('click', '.doUnsubscribe', function() {
				$(this).addClass('disabled');
				android.doUnsubscribe();
			});

			$(document).on('click', '.requestPermissions', function() {
				$(this).addClass('disabled');
				android.grantPermissions();
			});

			updateUI();

			android.readyReady();
		</script>

	</body>
</html>